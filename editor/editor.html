<head>
    <style>
        body {
            margin:0px;
        }
    </style>
    <script>
        function init()
        {
            window.keyController=new KeyController();
            window.map= new Map();
            var display=document.getElementById('display');
            var ctx=display.getContext('2d');
            ctx.canvas.width=window.innerWidth;
            ctx.canvas.height=window.innerHeight;        
            display.addEventListener('mousedown',function(e){window.keyController.action('mousedown',e.clientX,e.clientY);});
            document.body.addEventListener('keyup',function(e){window.keyController.action('keyup',e.key,0);});
        
            setInterval(run,40);
        }
    </script>
    <script>
        function run()
        {
            var display=document.getElementById('display');
            var ctx=display.getContext('2d');
            ctx.canvas.width=window.innerWidth;
            ctx.canvas.height=window.innerHeight;        

            if (window.keyController.mouseDown)
                {
                    window.map.add();
                    window.keyController.mouseOn=false;
                }
            window.map.draw(ctx);
        }
    </script>
    <script>
        class KeyController
        {
            constructor()
            {
                this.mouseDown=false;
                this.mouseX=0;
                this.mouseY=0;
            }
            action(event,x,y)
            {
                switch (event)
                {
                    case 'mousedown':
                        {
                            this.mouseDown=true;
                                if (window.innerWidth>window.innerHeight)
                                {
                                    this.mouseX=x/window.innerHeight-0.5;
                                    this.mouseY=y/window.innerHeight-0.5
                                }
                                else
                                {
                                    this.mouseX=x/window.innerWidht-0.5;
                                    this.mouseY=y/window.innerWidht-0.5;
                                }
                            break;
                        }
                    case 'keyup':
                        {
                            switch (x)
                            {
                                case 's':
                                    {
                                        alert ('to do.... save..');
                                        break;
                                    }
                                
                            break;

                            }
                        }
                }
            }
        }
    </script>
    <script>
        class Map
        {
            constructor()
            {
                this.objects = new Array();

                this.zoomX=50;
                this.zoomY=50;
            }
            draw(ctx)
            {
                ctx.fillStyle='green';
                ctx.fillRect(100,100,100,100);
                this.objects.forEach(object=>
                    {
                        var resolution=window.innerWidth;
                        if (resolution>window.innerHeight)resolution=window.innerHeight;
                        var posX=object.getPosX()*this.zoomX+resolution/2;
                        var posY=object.getPosY()*this.zoomY+resolution/2;
                        var squareSizeX=resolution/this.zoomX;
                        var squareSizeY=resolution/this.zoomY;
                        ctx.fillRect(posX,posY,squareSizeX,squareSizeY);

                    }
                );
            }
            add()
            {
                var resolution=window.innerWidth;
                if (resolution<window.innerHeight)resolution=window.innerHeight;
                var posX = window.keyController.mouseX*(resolution/(2*this.zoomX));
                var posY = window.keyController.mouseY*(resolution/(2*this.zoomY));
                var newElement=new MapObject();
                newElement.positionX=Math.floor(posX*100);
                newElement.positionY=Math.floor(posY*100);
                this.objects.push(newElement);
            }
        }
    </script>
    <script>
        class MapObject
        {
            constructor()
            {
                this.positionX=0;
                this.positionY=0;
            }
            getPosX()
            {
                return this.positionX/100;
            }
            getPosY()
            {
                return this.positionY/100;
            }
        }
    </script>
</head>
<body onload="init()">
    <canvas id="display"></canvas>
</body>
